plugins {
    id 'application'
    id 'org.jetbrains.kotlin.jvm' version '1.5.31'
    id "com.github.johnrengelman.shadow" version "7.1.0"
    id 'org.jetbrains.kotlin.plugin.serialization' version '1.5.31'
}

group "dev.moetz.buzzer"
version "0.0.1"
mainClassName = "dev.moetz.buzzer.ApplicationKt"

repositories {
    mavenCentral()
}

dependencies {
    implementation "io.ktor:ktor-server-core:$ktor_version"
    implementation "io.ktor:ktor-auth:$ktor_version"
    implementation "io.ktor:ktor-server-netty:$ktor_version"
    implementation "io.ktor:ktor-html-builder:$ktor_version"
    implementation "io.ktor:ktor-websockets:$ktor_version"
    implementation "io.ktor:ktor-serialization:$ktor_version"
    implementation "ch.qos.logback:logback-classic:$logback_version"

    implementation "org.jetbrains.kotlinx:kotlinx-serialization-json:$kotlinx_serialization_version"


    testImplementation 'org.amshove.kluent:kluent:1.68'
    testImplementation "io.mockk:mockk:1.12.2"

    testImplementation "io.ktor:ktor-server-tests:$ktor_version"
    testImplementation "org.jetbrains.kotlin:kotlin-test:$kotlin_version"
}

task copyShadowLibs(type: Copy) {
    from configurations.shadow
    into 'build/libs'
}

jar {
    manifest {
        attributes['Main-Class'] = 'dev.moetz.buzzer.ApplicationKt'
        attributes['Implementation-Title'] = "Buzzer"
        attributes['Implementation-Version'] = archiveVersion
    }
}

shadowJar {
    baseName = 'Buzzer'
    classifier = null
    version = null
    repositories {
        mavenCentral()
    }
}

shadowJar.dependsOn(copyShadowLibs)
